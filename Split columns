import pandas as pd
import json

# Step 1: Read the CSV file
df = pd.read_csv('input.csv')  # Replace 'input.csv' with the path to your CSV file

# Step 2: Define a function to extract the command line from the JSON
def extract_command_line(request_json):
    try:
        # Parse the JSON string and extract the command line field
        json_data = json.loads(request_json)
        return json_data['process']['command line']
    except (KeyError, ValueError, TypeError):  # Handle missing or malformed JSON
        return None

# Step 3: Apply the function to extract the command line field and create a new column
df['CommandLine'] = df['RequestJSON'].apply(extract_command_line)

# Step 4: Split both 'MonitorName' and 'Hostnames' columns by commas
df['MonitorName'] = df['MonitorName'].str.split(',')
df['Hostnames'] = df['Hostnames'].str.split(',')

# Step 5: Explode both columns to get all combinations
df = df.explode('MonitorName').explode('Hostnames')

# Step 6: Optional - Write the output to a new CSV
df.to_csv('output.csv', index=False)

# Display the resulting DataFrame
print(df)
